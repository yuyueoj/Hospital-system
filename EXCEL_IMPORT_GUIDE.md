# Excel数据导入指南

本指南将详细说明如何将Excel中的医生数据导入到微信小程序项目中。

## 📋 目录

1. [准备Excel数据](#1-准备excel数据)
2. [方案选择](#2-方案选择)
3. [方案一：Node.js命令行工具](#3-方案一nodejs命令行工具)
4. [方案二：在线转换工具](#4-方案二在线转换工具)
5. [数据应用到小程序](#5-数据应用到小程序)
6. [常见问题解决](#6-常见问题解决)

---

## 1. 准备Excel数据

### 1.1 必需列（列名必须完全匹配）

| 列名 | 说明 | 长度限制 | 示例 |
|------|------|----------|------|
| **医生姓名** | 医生的姓名 | 10字以内 | 张建华 |
| **医院名称** | 所属医院名称 | 20字以内 | 北京协和医院 |
| **科室** | 所属科室名称 | 20字以内 | 心血管内科 |

### 1.2 可选列

| 列名 | 说明 | 长度限制 | 示例 |
|------|------|----------|------|
| **医生照片** | 医生照片的网页链接 | 有效URL | https://example.com/photo1.jpg |
| **医生职称** | 医生职称 | 30字以内 | 主任医师、教授 |
| **擅长病症** | 擅长的疾病治疗 | 100字以内 | 冠心病、高血压、心律失常、心力衰竭 |
| **医生介绍** | 医生详细介绍 | 300字以内 | 从事心血管内科临床工作20余年，擅长冠心病介入治疗... |

### 1.3 Excel数据示例

```
| 医生姓名 | 医院名称 | 科室 | 医生职称 | 擅长病症 | 医生照片 |
|---------|---------|------|---------|---------|---------|
| 张建华 | 北京协和医院 | 心血管内科 | 主任医师、教授 | 冠心病、高血压、心律失常、心力衰竭 | https://example.com/photo1.jpg |
| 李明华 | 北京协和医院 | 消化内科 | 副主任医师、副教授 | 胃肠道疾病、肝胆疾病、消化道肿瘤 | https://example.com/photo2.jpg |
| 王志强 | 北京大学第一医院 | 普外科 | 主任医师、科室主任 | 腹腔镜手术、胃肠道肿瘤、疝气手术 | https://example.com/photo3.jpg |
```

---

## 2. 方案选择

我们提供两种导入方案，您可以根据需要选择：

### 方案对比

| 特性 | Node.js工具 | 在线工具 |
|------|------------|----------|
| **环境要求** | 需要Node.js | 只需浏览器 |
| **文件大小限制** | 无限制 | 浏览器限制 |
| **处理速度** | 快 | 中等 |
| **数据验证** | 详细 | 基本 |
| **批量处理** | 支持 | 不支持 |
| **离线使用** | 支持 | 不支持 |

**推荐选择：**
- 🔧 **大量数据 + 技术背景** → Node.js工具
- 🌐 **少量数据 + 简单操作** → 在线工具

---

## 3. 方案一：Node.js命令行工具

### 3.1 环境准备

```bash
# 1. 确保已安装Node.js (版本14+)
node --version

# 2. 进入项目目录
cd /path/to/your/project

# 3. 安装依赖
npm install
# 或者手动安装
npm install xlsx fs-extra
```

### 3.2 使用步骤

#### 第一步：准备Excel文件
将您的Excel文件放置在合适的位置，例如：
```
/workspace/data/doctors.xlsx
```

#### 第二步：运行转换命令
```bash
# 基本用法
node tools/excel-converter.js data/doctors.xlsx

# 指定工作表（如果Excel有多个sheet）
node tools/excel-converter.js data/doctors.xlsx --sheet "医生数据"
```

#### 第三步：查看转换结果
转换完成后，会在 `data/` 目录下生成：
- `hospital-data.json` - JSON格式数据
- `app-data.js` - 可直接在app.js中使用的格式

#### 第四步：查看转换报告
```
=== 数据导入统计报告 ===
医院总数: 2
科室总数: 3  
医生总数: 5

各医院详情:
  北京协和医院: 2个科室, 3位医生
  北京大学第一医院: 1个科室, 2位医生
========================
```

### 3.3 高级用法

#### 自定义输出路径
```bash
node tools/excel-converter.js data/doctors.xlsx --output custom/path/
```

#### 只验证数据（不转换）
```bash
node tools/excel-converter.js data/doctors.xlsx --validate-only
```

#### 详细日志模式
```bash
node tools/excel-converter.js data/doctors.xlsx --verbose
```

---

## 4. 方案二：在线转换工具

### 4.1 打开转换工具

在浏览器中打开：
```
file:///workspace/tools/online-converter.html
```

或者部署到Web服务器后访问。

### 4.2 使用步骤

#### 第一步：查看数据格式要求
页面会显示详细的Excel格式要求和示例。

#### 第二步：上传Excel文件
1. 点击"选择Excel文件"按钮
2. 选择您的`.xlsx`或`.xls`文件
3. 等待文件上传和处理

#### 第三步：查看验证结果
系统会自动验证数据并显示：
- 📊 数据统计（总行数、有效行数、错误数等）
- ❌ 错误列表（如果有）
- ⚠️ 警告信息（如重复数据）

#### 第四步：下载转换结果
如果验证通过，可以下载：
- 📄 JSON格式文件
- 📝 App.js格式文件  
- 📊 转换报告

### 4.3 在线工具特性

- ✅ **实时验证** - 即时显示数据问题
- 📱 **响应式设计** - 支持移动设备
- 🎨 **可视化界面** - 清晰的步骤指导
- 📊 **详细统计** - 完整的数据分析报告

---

## 5. 数据应用到小程序

### 5.1 方法一：直接替换数据

打开 `app.js` 文件，找到 `globalData.hospitalData`：

```javascript
// app.js
App({
  globalData: {
    // 将这里的数据替换为转换后的数据
    hospitalData: [
      // 粘贴转换后的JSON数据
    ]
  }
  // ... 其他代码
})
```

### 5.2 方法二：使用require引入

```javascript
// app.js
const hospitalData = require('./data/app-data.js');

App({
  globalData: {
    hospitalData: hospitalData
  }
  // ... 其他代码
})
```

### 5.3 方法三：动态加载（推荐）

```javascript
// app.js
App({
  onLaunch() {
    this.loadHospitalData();
  },
  
  async loadHospitalData() {
    try {
      // 从本地文件加载
      const data = require('./data/app-data.js');
      this.globalData.hospitalData = data;
      
      // 或者从服务器加载
      // const res = await wx.request({
      //   url: 'https://your-server.com/api/hospitals'
      // });
      // this.globalData.hospitalData = res.data;
      
    } catch (error) {
      console.error('数据加载失败:', error);
      // 使用默认数据
    }
  },
  
  globalData: {
    hospitalData: [] // 初始为空，动态加载
  }
})
```

---

## 6. 常见问题解决

### 6.1 数据验证错误

#### Q: "缺少必填字段"错误
**A:** 确保Excel中包含以下列名（大小写敏感）：
- 医生姓名
- 医院名称
- 科室名称

#### Q: "联系电话格式不正确"错误
**A:** 电话号码应该只包含数字、短横线、空格和括号，例如：
- ✅ `010-12345678`
- ✅ `(010) 1234-5678`
- ✅ `010 1234 5678`
- ❌ `电话：010-12345678`

#### Q: "重复医生数据"警告
**A:** 系统检测到相同医院、科室、姓名的医生，请检查数据是否重复。

### 6.2 文件处理问题

#### Q: Excel文件无法读取
**A:** 请确保：
1. 文件格式为 `.xlsx` 或 `.xls`
2. 文件没有密码保护
3. 文件没有被其他程序占用

#### Q: 转换后数据为空
**A:** 检查：
1. Excel第一行是否为列标题
2. 数据是否在第一个工作表中
3. 必填字段是否都有数据

### 6.3 小程序集成问题

#### Q: 小程序中显示"暂无医院数据"
**A:** 检查：
1. `app.js` 中的数据格式是否正确
2. 数据是否成功加载到 `globalData.hospitalData`
3. 页面是否正确获取数据

#### Q: 搜索功能无法找到医生
**A:** 确保：
1. 搜索关键词与医生信息匹配
2. 数据中包含中文字符时编码正确
3. `app.js` 中的搜索函数正常工作

### 6.4 性能优化

#### Q: 数据量大时加载慢
**A:** 优化建议：
1. **分页加载**：将数据分批加载
2. **懒加载**：按需加载医生详情
3. **数据压缩**：精简不必要的字段
4. **缓存机制**：使用小程序存储缓存数据

```javascript
// 示例：分页加载
loadHospitalsByPage(page = 1, pageSize = 10) {
  const start = (page - 1) * pageSize;
  const end = start + pageSize;
  return this.globalData.hospitalData.slice(start, end);
}
```

---

## 🎯 最佳实践

### 数据准备建议
1. **标准化命名**：统一医院和科室名称
2. **完整信息**：尽量填写所有可选字段
3. **数据验证**：导入前手动检查数据质量
4. **备份原文件**：保留Excel原始文件

### 转换流程建议
1. **小批量测试**：先用少量数据测试
2. **验证结果**：仔细检查转换后的数据
3. **增量更新**：支持数据的增量导入
4. **版本管理**：对数据文件进行版本控制

### 维护更新建议
1. **定期更新**：建立数据更新机制
2. **监控异常**：监控数据加载和搜索性能
3. **用户反馈**：收集用户对数据准确性的反馈
4. **日志记录**：记录数据更新和错误日志

---

## 📞 技术支持

如果在导入过程中遇到问题，请：

1. **查看错误日志**：注意控制台输出的详细错误信息
2. **检查数据格式**：对照本指南检查Excel格式
3. **尝试小数据集**：用少量数据测试流程
4. **查看示例文件**：参考提供的数据模板

---

**恭喜！** 🎉 您现在已经掌握了将Excel数据导入微信小程序的完整流程。根据您的具体需求选择合适的方案，就可以快速将医生数据集成到小程序中了。